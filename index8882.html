<!DOCTYPE html>
<html>
<head>
    <title>æ¶¨åœè‚¡æŸ¥è¯¢å·¥å…·ï¼ˆåŸºäºFree-Stock-APIï¼‰</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .config-box { background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        input, select, button { margin: 5px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #2196F3; color: white; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #2196F3; color: white; }
        .loading { display: none; color: #666; margin: 15px 0; }
        .error { color: red; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="config-box">
        <h2>ğŸ“ˆ æ¶¨åœè‚¡æŸ¥è¯¢é…ç½®</h2>
        <input type="date" id="dateInput" value="2023-11-01">
        <select id="sessionSelect">
            <option value="all">å…¨å¤©</option>
            <option value="am">æ—©ç›˜ (9:30-11:30)</option>
            <option value="pm">åˆç›˜ (13:00-15:00)</option>
        </select>
        <input type="number" id="bigOrderInput" placeholder="å¤§å•æœ€å°é‡‘é¢(ä¸‡)" value="500" min="0">
        <button onclick="loadData()">å¼€å§‹æŸ¥è¯¢</button>
        <div id="loading" class="loading">â³ æ•°æ®åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...</div>
        <div id="error" class="error"></div>
    </div>

    <table id="resultTable">
        <thead>
            <tr>
                <th>è‚¡ç¥¨ä»£ç </th>
                <th>è‚¡ç¥¨åç§°</th>
                <th>æ¶¨åœæ—¶é—´</th>
                <th>æœ€æ–°ä»·</th>
                <th>æ¶¨è·Œå¹…</th>
                <th>å¤§å•å‡€é¢(ä¸‡)</th>
            </tr>
        </thead>
        <tbody id="dataBody"></tbody>
    </table>

    <script>
        // æ ¸å¿ƒAPIé…ç½®
        const API_ENDPOINT = "https://api.itick.io/freeapi/stock/zt";
        
        // åŠ è½½æ•°æ®ä¸»å‡½æ•°
        async function loadData() {
            const date = document.getElementById('dateInput').value.replace(/-/g, '');
            const session = document.getElementById('sessionSelect').value;
            const minBigOrder = document.getElementById('bigOrderInput').value || 0;

            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').textContent = '';

            try {
                // è°ƒç”¨APIè·å–æ•°æ®
                const response = await fetch(`${API_ENDPOINT}?date=${date}`);
                if (!response.ok) throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                const data = await response.json();
                
                // ç­›é€‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®
                const filteredData = data.data.filter(item => {
                    const isZt = item.zt === 1;  // æ¶¨åœçŠ¶æ€
                    const timeMatch = checkTime(item.time, session);
                    const bigOrderMatch = (item.ddje / 10000) >= minBigOrder;
                    return isZt && timeMatch && bigOrderMatch;
                });

                renderTable(filteredData);
            } catch (error) {
                document.getElementById('error').textContent = `é”™è¯¯: ${error.message}`;
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // æ—¶é—´ç­›é€‰é€»è¾‘
        function checkTime(timeStr, session) {
            if (session === 'all') return true;
            const time = timeStr.split(':').map(Number);
            const hour = time[0];
            if (session === 'am') return hour >= 9 && hour < 12;
            if (session === 'pm') return hour >= 13 && hour < 15;
            return false;
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable(data) {
            const tbody = document.getElementById('dataBody');
            tbody.innerHTML = data.map(item => `
                <tr>
                    <td>${item.symbol}</td>
                    <td>${item.name}</td>
                    <td>${item.time}</td>
                    <td>${item.price}</td>
                    <td>${item.zdf}%</td>
                    <td>${(item.ddje / 10000).toFixed(2)}</td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>