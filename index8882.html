<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>沪深行情 - 自定义时段</title>
    <style>
        /* 新增设置面板样式 */
        :root {
            --primary-color: #007bff;
            --danger-color: #dc3545;
            --success-color: #28a745;
        }
        body {
            margin: 0;
            padding: 10px;
            font-family: system-ui, sans-serif;
        }
        .settings-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .time-config {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .time-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        input[type="time"] {
            padding: 8px;
            border: 2px solid #ced4da;
            border-radius: 6px;
            width: 120px;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
        }
        /* 其他样式保持与之前版本一致 */
    </style>
</head>
<body>
    <!-- 新增设置面板 -->
    <div class="settings-panel">
        <div class="time-config">
            <div class="time-input-group">
                <label>早盘时间：</label>
                <input type="time" id="morningStart" step="300">
                <span>-</span>
                <input type="time" id="morningEnd" step="300">
            </div>
            <div class="time-input-group">
                <label>午盘时间：</label>
                <input type="time" id="afternoonStart" step="300">
                <span>-</span>
                <input type="time" id="afternoonEnd" step="300">
            </div>
        </div>
        <button onclick="saveSettings()">保存设置</button>
    </div>

    <!-- 原有界面元素保持不变 -->
    <div class="header">
        <input type="date" id="datePicker">
        <div id="timeRange">当前时段：计算中...</div>
    </div>
    
    <div class="table-container">
        <table id="stockTable">...</table>
    </div>

<script>
// 新增设置管理逻辑
let tradingSettings = {
    morning: { start: '09:30', end: '11:30' },
    afternoon: { start: '13:00', end: '15:00' }
};

// 从本地存储加载设置
function loadSettings() {
    const saved = localStorage.getItem('tradingSettings');
    if (saved) {
        tradingSettings = JSON.parse(saved);
        document.getElementById('morningStart').value = tradingSettings.morning.start;
        document.getElementById('morningEnd').value = tradingSettings.morning.end;
        document.getElementById('afternoonStart').value = tradingSettings.afternoon.start;
        document.getElementById('afternoonEnd').value = tradingSettings.afternoon.end;
    }
}

// 保存设置到本地存储
function saveSettings() {
    tradingSettings = {
        morning: {
            start: document.getElementById('morningStart').value,
            end: document.getElementById('morningEnd').value
        },
        afternoon: {
            start: document.getElementById('afternoonStart').value,
            end: document.getElementById('afternoonEnd').value
        }
    };
    localStorage.setItem('tradingSettings', JSON.stringify(tradingSettings));
    alert('设置已保存！');
}

// 改进后的时段判断逻辑
function getTradingPeriod() {
    const now = new Date();
    const currentTime = now.getHours() * 60 + now.getMinutes();
    
    // 解析自定义时间
    const parseTime = (timeStr) => {
        const [h, m] = timeStr.split(':').map(Number);
        return h * 60 + m;
    };

    const morningStart = parseTime(tradingSettings.morning.start);
    const morningEnd = parseTime(tradingSettings.morning.end);
    const afternoonStart = parseTime(tradingSettings.afternoon.start);
    const afternoonEnd = parseTime(tradingSettings.afternoon.end);

    if (currentTime >= morningStart && currentTime <= morningEnd) return '早盘';
    if (currentTime >= afternoonStart && currentTime <= afternoonEnd) return '午盘';
    return '非交易时段';
}

// 初始化时加载设置
loadSettings();

/* 其余代码保持与之前版本一致 */
</script>
</body>
</html>