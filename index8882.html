<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>沪深涨停移动优化版</title>
    <style>
        /* 保持之前的移动端样式 */
    </style>
</head>
<body>
    <!-- 保持之前的HTML结构 -->

    <script>
        // 使用国际认可的代理服务
        const PROXY_URL = 'https://api.allorigins.win/raw?url=';
        const DATA_SOURCES = {
            yahoo: 'https://query1.finance.yahoo.com/v8/finance/chart/',
            tencent: 'http://qt.gtimg.cn/q=',
            eastmoney: 'https://push2.eastmoney.com/api/qt/ulist.np/get'
        };

        // 新版数据获取方法
        async function fetchStockData(code) {
            try {
                // 方案1：使用Yahoo Finance国际版
                const yahooUrl = `${DATA_SOURCES.yahoo}${code}.SS`; // 沪股后缀.SS
                const yahooResponse = await fetch(PROXY_URL + encodeURIComponent(yahooUrl), {
                    headers: {'Referer': 'https://finance.yahoo.com'}
                });
                
                if(yahooResponse.ok) {
                    const data = await yahooResponse.json();
                    return parseYahooData(data);
                }

                // 方案2：备用腾讯数据源（通过代理）
                const tencentUrl = PROXY_URL + encodeURIComponent(DATA_SOURCES.tencent + code);
                const tencentResponse = await fetch(tencentUrl);
                if(tencentResponse.ok) {
                    const text = await tencentResponse.text();
                    return parseTencentData(text);
                }

                // 方案3：东方财富API（推荐）
                const eastmoneyUrl = `${PROXY_URL}${encodeURIComponent(
                    `${DATA_SOURCES.eastmoney}?fields=f2,f3,f12,f13,f14&secids=1.${code}`
                )}`;
                const emResponse = await fetch(eastmoneyUrl);
                if(emResponse.ok) {
                    const json = await emResponse.json();
                    return parseEMData(json);
                }

                return null;
            } catch (error) {
                console.error('数据获取失败:', error);
                return null;
            }
        }

        // 解析Yahoo数据
        function parseYahooData(json) {
            const { meta, timestamp } = json.chart.result[0];
            return {
                name: meta.symbol,
                price: meta.regularMarketPrice.toFixed(2),
                close: meta.previousClose.toFixed(2),
                high: meta.regularMarketDayHigh.toFixed(2),
                timestamp: new Date(timestamp*1000).toLocaleTimeString()
            };
        }

        // 解析腾讯数据
        function parseTencentData(text) {
            const data = text.split('~');
            return {
                name: data[1],
                price: data[3],
                close: data[4],
                high: data[33]
            };
        }

        // 解析东方财富数据
        function parseEMData(json) {
            const item = json.data.diff[0];
            return {
                name: item.f14,
                price: item.f2/100,
                close: (item.f2/(1 + item.f3/10000))/100, // 计算昨日收盘价
                rise: item.f3/100
            };
        }

        // 修改涨停判断逻辑
        function isLimitUp(stock) {
            // 统一处理不同数据源的精度问题
            const close = parseFloat(stock.close);
            const price = parseFloat(stock.price);
            return (price / close >= 1.0995); // 考虑四舍五入
        }

        // 保持其他逻辑不变
    </script>
</body>
</html>